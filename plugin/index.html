<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Adachi-Plugin 开发者文档 | Adachi-GBOT</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="无">
    
    <link rel="preload" href="/assets/css/0.styles.0530ef19.css" as="style"><link rel="preload" href="/assets/js/app.c1cc24a2.js" as="script"><link rel="preload" href="/assets/js/2.0695181e.js" as="script"><link rel="preload" href="/assets/js/11.ce63f6ea.js" as="script"><link rel="prefetch" href="/assets/js/10.768b5d8e.js"><link rel="prefetch" href="/assets/js/12.cea27ba1.js"><link rel="prefetch" href="/assets/js/13.7a19c39c.js"><link rel="prefetch" href="/assets/js/14.10581032.js"><link rel="prefetch" href="/assets/js/3.440fa464.js"><link rel="prefetch" href="/assets/js/4.d8210400.js"><link rel="prefetch" href="/assets/js/5.1933923e.js"><link rel="prefetch" href="/assets/js/6.4307e75f.js"><link rel="prefetch" href="/assets/js/7.0e62ca09.js"><link rel="prefetch" href="/assets/js/8.b753cdbd.js"><link rel="prefetch" href="/assets/js/9.adddd8f7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0530ef19.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Adachi-GBOT</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/deploy/" class="nav-link">
  部署
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="/thank/" class="nav-link">
  致谢
</a></div><div class="nav-item"><a href="/image/" class="nav-link">
  展示
</a></div><div class="nav-item"><a href="/plugin/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  插件开发
</a></div><div class="nav-item"><a href="/question/" class="nav-link">
  常见问题
</a></div><div class="nav-item"><a href="/update/" class="nav-link">
  更新日志
</a></div><div class="nav-item"><a href="https://github.com/Extrwave/Adachi-GBOT" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/deploy/" class="nav-link">
  部署
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="/thank/" class="nav-link">
  致谢
</a></div><div class="nav-item"><a href="/image/" class="nav-link">
  展示
</a></div><div class="nav-item"><a href="/plugin/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  插件开发
</a></div><div class="nav-item"><a href="/question/" class="nav-link">
  常见问题
</a></div><div class="nav-item"><a href="/update/" class="nav-link">
  更新日志
</a></div><div class="nav-item"><a href="https://github.com/Extrwave/Adachi-GBOT" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Adachi-Plugin 开发者文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/plugin/#adachi-plugin-开发者文档" class="sidebar-link">Adachi-Plugin 开发者文档</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/plugin/#注册插件" class="sidebar-link">注册插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin/#声明" class="sidebar-link">声明</a></li><li class="sidebar-sub-header"><a href="/plugin/#实现" class="sidebar-link">实现</a></li></ul></li><li><a href="/plugin/#global" class="sidebar-link">Global</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin/#bot" class="sidebar-link">BOT</a></li><li class="sidebar-sub-header"><a href="/plugin/#userid类型" class="sidebar-link">UserID类型</a></li><li class="sidebar-sub-header"><a href="/plugin/#inputparameter" class="sidebar-link">InputParameter</a></li></ul></li><li><a href="/plugin/#commandfunc" class="sidebar-link">CommandFunc</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/plugin/#messagescope" class="sidebar-link">MessageScope</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/plugin/#authlevel" class="sidebar-link">AuthLevel</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/plugin/#command" class="sidebar-link">Command</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin/#commandinfo" class="sidebar-link">CommandInfo</a></li><li class="sidebar-sub-header"><a href="/plugin/#order" class="sidebar-link">Order</a></li><li class="sidebar-sub-header"><a href="/plugin/#switch" class="sidebar-link">Switch</a></li><li class="sidebar-sub-header"><a href="/plugin/#enquire" class="sidebar-link">Enquire</a></li></ul></li><li><a href="/plugin/#database" class="sidebar-link">Database</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin/#common" class="sidebar-link">Common</a></li><li class="sidebar-sub-header"><a href="/plugin/#string" class="sidebar-link">String</a></li><li class="sidebar-sub-header"><a href="/plugin/#hash" class="sidebar-link">Hash</a></li><li class="sidebar-sub-header"><a href="/plugin/#list" class="sidebar-link">List</a></li><li class="sidebar-sub-header"><a href="/plugin/#developer-set-set" class="sidebar-link">/developer/#set)Set</a></li><li class="sidebar-sub-header"><a href="/plugin/#client" class="sidebar-link">client</a></li></ul></li><li><a href="/plugin/#botconfig" class="sidebar-link">BotConfig</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/plugin/#filemanagement" class="sidebar-link">FileManagement</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin/#presetplace" class="sidebar-link">PresetPlace</a></li><li class="sidebar-sub-header"><a href="/plugin/#common-2" class="sidebar-link">Common</a></li><li class="sidebar-sub-header"><a href="/plugin/#file" class="sidebar-link">File</a></li><li class="sidebar-sub-header"><a href="/plugin/#directory" class="sidebar-link">Directory</a></li><li class="sidebar-sub-header"><a href="/plugin/#yaml" class="sidebar-link">YAML</a></li></ul></li><li><a href="/plugin/#authorization" class="sidebar-link">Authorization</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/plugin/#msgmanagement" class="sidebar-link">MsgManagement</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/plugin/#refreshconfig" class="sidebar-link">RefreshConfig</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin/#refreshcatch" class="sidebar-link">RefreshCatch</a></li><li class="sidebar-sub-header"><a href="/plugin/#refreshtarget" class="sidebar-link">RefreshTarget</a></li><li class="sidebar-sub-header"><a href="/plugin/#registerrefreshablefile" class="sidebar-link">registerRefreshableFile</a></li><li class="sidebar-sub-header"><a href="/plugin/#registerrefreshablefunc" class="sidebar-link">registerRefreshableFunc</a></li></ul></li><li><a href="/plugin/#path-alias" class="sidebar-link">Path Alias</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="adachi-plugin-开发者文档"><a href="#adachi-plugin-开发者文档" class="header-anchor">#</a> Adachi-Plugin 开发者文档</h2> <h2 id="注册插件"><a href="#注册插件" class="header-anchor">#</a> 注册插件</h2> <p><code>插件(Plugin)</code> 是由开发者创建的 <code>指令(Command)</code> 的集合。注册插件只需要在 <code>/src/plugins</code> 目录下创建一个文件夹，然后完成「声明」和「实现」两个步骤。</p> <h3 id="声明"><a href="#声明" class="header-anchor">#</a> 声明</h3> <p>声明插件只需在上文提到的文件夹中创建一个名为 <code>init.ts</code> 的文件，文件的格式如下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// /src/plugins/example/init.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PluginSetting <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@modules/plugin&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OrderConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@modules/command&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> echo<span class="token operator">:</span> OrderConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;order&quot;</span><span class="token punctuation">,</span>
    cmdKey<span class="token operator">:</span> <span class="token string">&quot;silvery-star.echo&quot;</span><span class="token punctuation">,</span>
    desc<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;复读&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;[任意内容]&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;echo&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    regexps<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;.+&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 不可 default 导出，函数名固定</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>PluginSetting<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> 
        pluginName<span class="token operator">:</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">,</span> 
        cfgList<span class="token operator">:</span> <span class="token punctuation">[</span> echo <span class="token punctuation">]</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这是一个最简单的声明插件的例子，它声明了一个名为 <code>example</code> 的插件，同时定义了一个用于复读消息的 <a href="https://docs.adachi.top/developer/#order" target="_blank" rel="noopener noreferrer">Order类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 指令，下面我们来实现这个插件。</p> <h3 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h3> <p>每个指令都可以配置一个可选的 <code>main</code> 属性，表示实现这个指令的文件位置，或实现指令的函数，它的缺省值为 <code>index</code> ，即在 <code>init.ts</code> 的同一目录下的 <code>index.ts</code> 文件中实现，文件的格式如下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// /src/plugins/example/index.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> InputParameter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@modules/command&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 不可 default 导出，函数名固定</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span> i<span class="token operator">:</span> InputParameter <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> i<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span> i<span class="token punctuation">.</span>messageData<span class="token punctuation">.</span>raw_message <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如此就可以非常简单的实现一个 <code>echo</code> 指令复读的功能。其中 <a href="https://docs.adachi.top/developer/#inputparameter" target="_blank" rel="noopener noreferrer">InputParameter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是 <code>main</code> 函数的入参对象，负责提供实现指令时可能需要使用到的工具和数据。</p> <p>在此基础上，你可以通过下面提供的工具来实现功能各异的插件。</p> <h2 id="global"><a href="#global" class="header-anchor">#</a> Global</h2> <h3 id="bot"><a href="#bot" class="header-anchor">#</a> BOT</h3> <p><code>BOT</code> 是 <code>Adachi-GBOT</code> 中定义全局工具类的接口，它被定义为：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">BOT</span></span> <span class="token punctuation">{</span>
   <span class="token keyword">readonly</span> redis<span class="token operator">:</span> Database<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> config<span class="token operator">:</span> BotConfig<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> client<span class="token operator">:</span> sdk<span class="token punctuation">.</span>IOpenAPI<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> ws<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> logger<span class="token operator">:</span> log<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> qiniuyun<span class="token operator">:</span> Qiniuyun<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> interval<span class="token operator">:</span> Interval<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> file<span class="token operator">:</span> FileManagement<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> auth<span class="token operator">:</span> Authorization<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> message<span class="token operator">:</span> MsgManagement<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> command<span class="token operator">:</span> Command<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> refresh<span class="token operator">:</span> RefreshConfig<span class="token punctuation">;</span>
   <span class="token keyword">readonly</span> renderer<span class="token operator">:</span> BasicRenderer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>每个工具类的含义和包含的方法都会在后文中进行一一介绍。</p> <p>这个接口实例整体会被传入 <code>init()</code> ，你可以通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#%E8%A7%A3%E6%9E%84%E5%AF%B9%E8%B1%A1" target="_blank" rel="noopener noreferrer">解构对象 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的方式来获取其中的某个工具，以便进行声明插件的准备工作，如创建配置文件等。在代码的其他地方，你也可以通过下面的代码导入所有工具类。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> bot <span class="token keyword">from</span> <span class="token string">&quot;ROOT&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="userid类型"><a href="#userid类型" class="header-anchor">#</a> <code>UserID</code>类型</h3> <p>由原先QQ号  <code>number</code>改成了频道用户ID  <code>string</code></p> <h3 id="inputparameter"><a href="#inputparameter" class="header-anchor">#</a> InputParameter</h3> <p>指令实现的入参对象，被定义为：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">/* 监听到消息的类型 */</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Message</span> <span class="token punctuation">{</span>
	eventType<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
	eventId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
	msg<span class="token operator">:</span> <span class="token punctuation">{</span>
		author<span class="token operator">:</span> <span class="token punctuation">{</span>
			avatar<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
			bot<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
			id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
			username<span class="token operator">:</span> <span class="token builtin">string</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		channel_id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
		content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
		direct_message<span class="token operator">?</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		guild_id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
		id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
		member<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			joined_at<span class="token operator">:</span> <span class="token builtin">string</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		timestamp<span class="token operator">:</span> <span class="token builtin">string</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">InputParameter</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	sendMessage<span class="token operator">:</span> SendFunc<span class="token punctuation">;</span>
	messageData<span class="token operator">:</span> Message<span class="token punctuation">;</span>
	matchResult<span class="token operator">:</span> MatchResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token operator">&amp;</span> <span class="token constant">BOT</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="commandfunc"><a href="#commandfunc" class="header-anchor">#</a> <code>CommandFunc</code></h2> <p>实际上，<code>main</code> 函数是这样被定义的：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">CommandFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span> input<span class="token operator">:</span> InputParameter <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>换言之，在实现插件的函数内，你除了能获取所有的工具类，还能得到消息回复函数、消息事件数据和正则匹配结果。</p> <h2 id="messagescope"><a href="#messagescope" class="header-anchor">#</a> MessageScope</h2> <p>指令作用域，表示某条指令的可被触发范围，被定义为：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">enum</span> MessageScope <span class="token punctuation">{</span>
	Neither<span class="token punctuation">,</span>
	Group <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
	Private <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
	Both <span class="token operator">=</span> Group <span class="token operator">|</span> Private
<span class="token punctuation">}</span>
</code></pre></div><h2 id="authlevel"><a href="#authlevel" class="header-anchor">#</a> AuthLevel</h2> <p>权限等级，被定义为：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">enum</span> AuthLevel <span class="token punctuation">{</span>
	Banned<span class="token punctuation">,</span>
	User<span class="token punctuation">,</span>
	Manager<span class="token punctuation">,</span>
	Master
<span class="token punctuation">}</span>
</code></pre></div><p>其中，<code>User</code> 是默认权限等级；<code>Master</code> 是持有者，最高权限等级。</p> <h2 id="command"><a href="#command" class="header-anchor">#</a> Command</h2> <p>事实上，指令才是 <code>Adachi-BOT</code> 设计中的「第一公民」。出于简化指令实现代码，强化用户配置的考虑，我们暂时将指令分为以下三种：<code>命令式(Order)</code> 、 <code>开关式(Switch)</code> 和 <code>询问式(Enquire)</code> 。</p> <h3 id="commandinfo"><a href="#commandinfo" class="header-anchor">#</a> CommandInfo</h3> <p><code>CommandInfo</code> 表示了所有类型指令的公用配置属性，它的定义如下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">CommandInfo</span> <span class="token operator">=</span> Required<span class="token operator">&lt;</span>
	Optional<span class="token operator">&lt;</span>BasicConfig<span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;cmdKey&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;desc&quot;</span>
<span class="token operator">&gt;</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span> main<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> CommandFunc <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这或许有些抽象，我们可以将其展开：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">CommandInfo</span> <span class="token punctuation">{</span>
    cmdKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    desc<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
    detail<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    auth<span class="token operator">?</span><span class="token operator">:</span> AuthLevel<span class="token punctuation">;</span>
    scope<span class="token operator">?</span><span class="token operator">:</span> MessageScope<span class="token punctuation">;</span>
    display<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    ignoreCase<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    main<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> CommandFunc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="cmdkey"><a href="#cmdkey" class="header-anchor">#</a> <code>cmdKey</code></h4> <p>必填字段，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。表示指令的 <code>key</code> 值，唯一指定，用于区分不同的指令。该值应简记为 <code>开发者.指令功能</code> 或 <code>插件名.指令功能</code> ，点号两侧均应使用 <code>kebab-case</code> ，如：<code>silvery-star.uid-query</code> 。</p> <h4 id="desc"><a href="#desc" class="header-anchor">#</a> <code>desc</code></h4> <p>必填字段，[<a href="https://www.typescriptlang.org/docs/handbook/2/objects.html#tuple-types" target="_blank" rel="noopener noreferrer">string, string] <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。为对指令的基本描述。<code>desc[0]</code> 应为对指令作用的简短描述，四字最佳；<code>desc[1]</code> 应为指令的参数列表，视指令类型不同用不同的形式。</p> <h4 id="detail"><a href="#detail" class="header-anchor">#</a> <code>detail</code></h4> <p>选填字段，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型，缺省值为 <code>&quot;该指令暂无更多信息&quot;</code> 。表示指令详细内容，当用户使用 <code>adachi.detail</code> 指令时将返回此字段。</p> <h4 id="auth"><a href="#auth" class="header-anchor">#</a> <code>auth</code></h4> <p>选填字段，<a href="https://docs.adachi.top/developer/#authlevel" target="_blank" rel="noopener noreferrer">AuthLevel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类型，缺省值为 <code>AuthLevel.User</code> 。表示允许使用该指令的最低权限。设置为 <code>AuthLevel.Banned</code> 时无效，被封禁用户无法使用任何指令。</p> <h4 id="scope"><a href="#scope" class="header-anchor">#</a> <code>scope</code></h4> <p>选填字段，<a href="https://docs.adachi.top/developer/#messagescope" target="_blank" rel="noopener noreferrer">MessageScope<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类型，缺省值为 <code>MessageScope.Both</code> 。表示允许使用该指令的位置。</p> <h4 id="display"><a href="#display" class="header-anchor">#</a> <code>display</code></h4> <p>选填字段，[boolean 类型，缺省值为 <code>true</code> 。表示是否在 <code>adachi.help</code> 返回内容中显示此指令。</p> <h4 id="ignorecase"><a href="#ignorecase" class="header-anchor">#</a> <code>ignoreCase</code></h4> <p>选填字段，[boolean 类型，缺省值为 <code>true</code> 。表示正则匹配是否忽略大小写。</p> <h4 id="main"><a href="#main" class="header-anchor">#</a> <code>main</code></h4> <p>选填字段，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或 <a href="https://docs.adachi.top/developer/#commandfunc" target="_blank" rel="noopener noreferrer">CommandFunc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类型，缺省值为 <code>&quot;index&quot;</code> 。表示指令入口。</p> <h3 id="order"><a href="#order" class="header-anchor">#</a> Order</h3> <p>命令式指令。将指令分为「指令头」和「指令参数」两个部分，其中「指令头」用于区分不同的指令，「指令参数」用于进行功能的实现。它的定义如下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">OrderConfig</span> <span class="token operator">=</span> CommandInfo <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
	type<span class="token operator">:</span> <span class="token string">&quot;order&quot;</span><span class="token punctuation">;</span>
	headers<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	regexps<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	start<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
	stop<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="type"><a href="#type" class="header-anchor">#</a> <code>type</code></h4> <p>固定字段。</p> <h4 id="headers"><a href="#headers" class="header-anchor">#</a> <code>headers</code></h4> <p>必填字段，string[]类型。表示该指令的所有指令头，可由用户配置。所有的指令头前都会被添加上用户在 <code>setting.yml</code> 中配置的 <code>header</code> 属性，如果你想忽略它，请在你的指令头前添加双下划线 <code>__</code> 。</p> <h4 id="regexps"><a href="#regexps" class="header-anchor">#</a> <code>regexps</code></h4> <p>必填字段，string[] 或 string[][] 类型。表示该指令的所有正则匹配，不可由用户配置。该字段可以表示为一维或二维字符串数组，它们的含义分别是：</p> <ul><li>一维数组时，表示一个正则表达式。数组由「正则匹配单元」组成，如 <code>[ &quot;(add|rem)&quot;, &quot;\\d+&quot; ]</code> ，在生成最终的正则表达式时，该指令头和该数组的所有元素被拼接起来，如 <code>/#example *(add|rem) *\d+/</code> 。</li> <li>二维数组时，表示若干个正则表达式。数组由上一点提到的一维数组组成。</li></ul> <h4 id="start"><a href="#start" class="header-anchor">#</a> <code>start</code></h4> <p>选填字段，[boolean 类型，缺省值为 <code>true</code> 。表示是否要在最终正则表达式前添加 <code>^</code> 。</p> <h4 id="stop"><a href="#stop" class="header-anchor">#</a> <code>stop</code></h4> <p>选填字段，[boolean 类型，缺省值为 <code>true</code> 。表示是否要在最终正则表达式后添加 <code>$</code> 。</p> <h4 id="desc-1"><a href="#desc-1" class="header-anchor">#</a> <code>desc[1]</code></h4> <p>必填字段，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。表示指令的参数列表，<code>Order</code> 型指令中，其中必填参数用 <code>[]</code> 包裹，选填参数用 <code>()</code> 包裹，如 <code>&quot;r(次数)d[面数]k(前k大)&quot;</code> 。</p> <h4 id="messagedate-msg-content"><a href="#messagedate-msg-content" class="header-anchor">#</a> <code>messageDate.msg.content</code></h4> <p>该值将会被去除指令头。注意，<code>ignoreCase</code> 设置为 <code>true</code> 时，<code>raw_message</code> 将为全小写字符串。</p> <h4 id="ordermatchresult"><a href="#ordermatchresult" class="header-anchor">#</a> <code>OrderMatchResult</code></h4> <p><code>Order</code> 型指令，匹配成功后将返回给 <code>main</code> 函数匹配到的「指令头」。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">OrderMatchResult</span> <span class="token punctuation">{</span>
	type<span class="token operator">:</span> <span class="token string">&quot;order&quot;</span><span class="token punctuation">;</span>
	header<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="switch"><a href="#switch" class="header-anchor">#</a> Switch</h3> <p>开关式指令。这是「命令式指令」的一类特化。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">SwitchConfig</span> <span class="token operator">=</span> CommandInfo <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
	type<span class="token operator">:</span> <span class="token string">&quot;switch&quot;</span><span class="token punctuation">;</span>
	onKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	offKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	header<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	mode<span class="token operator">:</span> <span class="token string">&quot;single&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;divided&quot;</span><span class="token punctuation">;</span>
	regexp<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	start<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
	stop<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="type-2"><a href="#type-2" class="header-anchor">#</a> <code>type</code></h4> <p>固定字段。</p> <h4 id="onkey"><a href="#onkey" class="header-anchor">#</a> <code>onKey</code></h4> <p>必填字段，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。表示指令状态为「开」的关键词。</p> <h4 id="offkey"><a href="#offkey" class="header-anchor">#</a> <code>offKey</code></h4> <p>必填字段，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。表示指令状态为「关」的关键词。</p> <h4 id="header"><a href="#header" class="header-anchor">#</a> <code>header</code></h4> <p>必填字段，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。表示该指令的唯一指令头，可由用户配置。指令头前都会被添加上用户在 <code>setting.yml</code> 中配置的 <code>header</code> 属性，如果你想忽略它，请在你的指令头前添加双下划线 <code>__</code> 。</p> <h4 id="developer-mode-mode"><a href="#developer-mode-mode" class="header-anchor">#</a> /developer/#mode)<code>mode</code></h4> <p>必填字段，<a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#union-types" target="_blank" rel="noopener noreferrer">&quot;single&quot; | &quot;divided&quot; <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。表示开关类指令的构成模式。</p> <ul><li>设置为 <code>single</code> 时，表示单指令头模式。开/关关键词将被 <code>|</code> 连接作为可选单元，最终被组装为形如 <code>header (on|off)</code> 的表达式。</li> <li>设置为 <code>divided</code> 时，表示拆分指令头模式。此时 <code>header</code> 配置将被忽略，开关关键词将作为 <code>header</code> ，最终将被组装为形如 <code>(onKey|offKey) prams</code> 的表达式。</li></ul> <h4 id="developer-regexp-regexp"><a href="#developer-regexp-regexp" class="header-anchor">#</a> /developer/#regexp)<code>regexp</code></h4> <p>必填字段，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或 [string<a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#arrays" target="_blank" rel="noopener noreferrer">] <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。表示匹配的正则表达式不可由用户配置。该字段可以表示为字符串或一维字符串数组，它们的含义分别是：</p> <ul><li>字符串时，表示完整的表达式，将被直接拼接到指令头上。</li> <li>一维数组时，同 <a href="https://docs.adachi.top/developer/#regexps" target="_blank" rel="noopener noreferrer">Order<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 指令中的 <code>regexps</code> 的一维数组清空。</li></ul> <p>特别的，<code>Switch</code> 指令还允许你在正则表达式中使用 <code>#{OPT}</code> 来标识开/关关键词的位置，如 <code>[ &quot;#{OPT}&quot;, &quot;\\d+&quot; ]</code> ，这将导出如 <code>/#calc (add|sub) \d+/</code> 的指令。<code>#{OPT}</code> 标识在 <code>divided</code> 模式中不生效。</p> <h4 id="developer-start-2-start"><a href="#developer-start-2-start" class="header-anchor">#</a> /developer/#start-2)<code>start</code></h4> <p>同 <a href="https://docs.adachi.top/developer/#start" target="_blank" rel="noopener noreferrer">Order - start<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="developer-stop-2-stop"><a href="#developer-stop-2-stop" class="header-anchor">#</a> /developer/#stop-2)<code>stop</code></h4> <p>同 <a href="https://docs.adachi.top/developer/#stop" target="_blank" rel="noopener noreferrer">Order - stop<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="developer-desc-1-2-desc-1"><a href="#developer-desc-1-2-desc-1" class="header-anchor">#</a> /developer/#desc-1-2)<code>desc[1]</code></h4> <p>在 <code>Switch</code> 类型中的指令描述中，你也可以使用 <code>#{OPT}</code> 来标识开/关关键词的位置。同样，该标识在 <code>divided</code> 模式中不生效。</p> <h4 id="developer-switchmatchresult-switchmatchresult"><a href="#developer-switchmatchresult-switchmatchresult" class="header-anchor">#</a> /developer/#switchmatchresult)<code>SwitchMatchResult</code></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">SwitchMatchResult</span> <span class="token punctuation">{</span>
	type<span class="token operator">:</span> <span class="token string">&quot;switch&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">switch</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	match<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">isOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Switch</code> 型指令，匹配成功后将返回给 <code>main</code> 函数匹配到的关键词 <code>switch</code> ，关键词是否为 <code>onKey</code> 的函数 <code>isOn</code> 和剩余匹配结果列表 <code>match</code> 。</p> <h3 id="enquire"><a href="#enquire" class="header-anchor">#</a> Enquire</h3> <p>询问式指令。支持类似正常说话类型的指令解构。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">RegUnit</span> <span class="token punctuation">{</span>
	regexp<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	senDesc<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">EnquireConfig</span> <span class="token operator">=</span> CommandInfo <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
	type<span class="token operator">:</span> <span class="token string">&quot;enquire&quot;</span><span class="token punctuation">;</span>
	sentences<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	definedPair<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> RegUnit<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="type-3"><a href="#type-3" class="header-anchor">#</a> <code>type</code></h4> <p>固定字段。</p> <h4 id="sentences"><a href="#sentences" class="header-anchor">#</a> <code>sentences</code></h4> <p>必填字段，[string<a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#arrays" target="_blank" rel="noopener noreferrer">] <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。表示「询问句式」。</p> <h4 id="definedpair"><a href="#definedpair" class="header-anchor">#</a> <code>definedPair</code></h4> <p>必填字段，<a href="https://www.typescriptlang.org/docs/handbook/utility-types.html#recordkeys-type" target="_blank" rel="noopener noreferrer">Record <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>&lt;<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, RegUnit&gt; 类型。表示「句式单元」。这是 <code>Enquire</code> 类型指令的核心部分，通过开发者定义变量名和获取变量的正则表达式，来加强指令的可配置性。一个「句式单元」的组成如下：</p> <ul><li><code>camelCase</code> 的 <code>string</code> 类型变量作为 <code>key</code> ，这个 <code>key</code> 将被转化为 <code>SNAKE_CASE</code> 用于「询问句式」中，并被 <code>#{}</code> 包裹，例如 <code>webConsole =&gt; #{WEB_CONSOLE}</code>。</li> <li><code>RegUnit</code> 则是一个包含「正则匹配单元」和描述的对象，其中正则匹配单元将被替换到「询问句式」含标识符的位置，并被添加 <code>()</code> 包裹（所以你不需要为可选符号的外部添加括号）。</li></ul> <h4 id="desc-1-2"><a href="#desc-1-2" class="header-anchor">#</a> <code>desc[1]</code></h4> <p>你不需要为 <code>Enquire</code> 类型配置 <code>desc[1]</code> ，保留空字符串即可。</p> <h4 id="enquirematchresult"><a href="#enquirematchresult" class="header-anchor">#</a> <code>EnquireMatchResult</code></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">EnquireMatchResult</span> <span class="token punctuation">{</span>
	type<span class="token operator">:</span> <span class="token string">&quot;enquire&quot;</span><span class="token punctuation">;</span>
	matchPair<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Enqire</code> 型指令，匹配成功后将返回给 <code>main</code> 函数匹配到的所有「句式单元」表示的 <code>key</code> 和获取的 <code>value</code> 。</p> <h4 id="header-2"><a href="#header-2" class="header-anchor">#</a> <code>#{HEADER}</code></h4> <p>这是一个保留标识符，表示用户在 <code>setting.yml</code> 中配置的 <code>header</code> 属性，你也可以在 <code>sentences</code> 中直接使用它，无需定义。</p> <h4 id="example"><a href="#example" class="header-anchor">#</a> Example</h4> <p>上面的内容并不容易让人理解 <code>Enquire</code> 指令的配置方法，下面将提供一个简单的实现 <code>Enquire</code> 指令的例子。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> simpleSentence<span class="token operator">:</span> EnquireConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
	type<span class="token operator">:</span> <span class="token string">&quot;enquire&quot;</span><span class="token punctuation">,</span>
	cmdKey<span class="token operator">:</span> <span class="token string">&quot;tools.test&quot;</span><span class="token punctuation">,</span>
	desc<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;简单句&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
	definedPair<span class="token operator">:</span> <span class="token punctuation">{</span>
		obj<span class="token operator">:</span> <span class="token punctuation">{</span>			<span class="token comment">// #{OBJ}</span>
			regexp<span class="token operator">:</span> <span class="token string">&quot;\\w+&quot;</span><span class="token punctuation">,</span> 
			senDesc<span class="token operator">:</span> <span class="token string">&quot;宾语&quot;</span> 
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		sub<span class="token operator">:</span> <span class="token punctuation">{</span> 			<span class="token comment">// #{SUB}</span>
			regexp<span class="token operator">:</span> <span class="token string">&quot;I|you|he|she&quot;</span><span class="token punctuation">,</span> 
			senDesc<span class="token operator">:</span> <span class="token string">&quot;主语&quot;</span> 
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		pred<span class="token operator">:</span> <span class="token punctuation">{</span> 		<span class="token comment">// #{PRED}</span>
			regexp<span class="token operator">:</span> <span class="token string">&quot;am|is|are&quot;</span><span class="token punctuation">,</span> 
			senDesc<span class="token operator">:</span> <span class="token string">&quot;系动词&quot;</span> 
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		verb<span class="token operator">:</span> <span class="token punctuation">{</span> 		<span class="token comment">// #{VERB}</span>
			regexp<span class="token operator">:</span> <span class="token string">&quot;\\w+&quot;</span><span class="token punctuation">,</span> 
			senDesc<span class="token operator">:</span> <span class="token string">&quot;动词&quot;</span> 
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		modalVerb<span class="token operator">:</span> <span class="token punctuation">{</span> 	<span class="token comment">// #{MODAL_VERB}</span>
			regexp<span class="token operator">:</span> <span class="token string">&quot;can|could|may|might&quot;</span><span class="token punctuation">,</span> 
			senDesc<span class="token operator">:</span> <span class="token string">&quot;情态动词&quot;</span> 
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	sentences<span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;#{SUB} #{PRED} #{OBJ}&quot;</span><span class="token punctuation">,</span>
		<span class="token comment">// =&gt; /(I|you|he|she) (am|is|are) \w+/i</span>
		<span class="token string">&quot;#{HEADER}#{MODAL_VERB} #{SUB} #{VERB} #{OBJ}&quot;</span>
		<span class="token comment">// =&gt; /#(can|could|may|might) (I|you|he|she) \w+ \w+/i</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这个例子中，我们定义了五个「句式单元」，并通过它们写了两个简单的询问句式，备注中写出了它们的导出正则。了解了定义后，实现就非常简单了：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> InputParameter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@modules/command&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span> i<span class="token operator">:</span> InputParameter <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> i<span class="token punctuation">.</span>matchResult <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * &lt;= I am developer
 * =&gt; matchPair: { sub: &quot;I&quot;, pred: &quot;am&quot;, obj: &quot;developer&quot; }
 *
 * &lt;= #Can you write code
 * =&gt; matchPair: {
 *        header: &quot;#&quot;, modalVerb: &quot;Can&quot;,
 *        sub: &quot;you&quot;, verb: &quot;write&quot;, obj: &quot;code&quot;
 *    }
 **/</span>
</code></pre></div><h2 id="database"><a href="#database" class="header-anchor">#</a> Database</h2> <p><code>Adachi-BOT</code> 使用了 <code>Redis</code> 作为数据库并简单的封装了一些常用方法。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">DatabaseMethod</span> <span class="token punctuation">{</span>
	<span class="token comment">// Common</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> time<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">deleteKey</span><span class="token punctuation">(</span> <span class="token operator">...</span>keys<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">getKeysByPrefix</span><span class="token punctuation">(</span> prefix<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token comment">// Hash</span>
	<span class="token function">setHash</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">getHash</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">delHash</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>fields<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">incHash</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> field<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> increment<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">existHashKey</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> field<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token comment">// String</span>
	<span class="token function">setString</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">getString</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token comment">// List</span>
	<span class="token function">getList</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">getListLength</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">addListElement</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">delListElement</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">existListElement</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token comment">// Set</span>
	<span class="token function">getSet</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">getSetMemberNum</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">addSetMember</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">delSetMember</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">existSetMember</span><span class="token punctuation">(</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="common"><a href="#common" class="header-anchor">#</a> Common</h3> <p>通用方法。</p> <h4 id="键名约定"><a href="#键名约定" class="header-anchor">#</a> 键名约定</h4> <p>同 <a href="https://docs.adachi.top/developer/#cmdkey" target="_blank" rel="noopener noreferrer">cmdKey<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，简记为 <code>开发者.数据作用</code> 或 <code>插件名.数据作用</code> ，点号两侧均应使用 <code>kebab-case</code> ，如：<code>silvery-star.user-bind-id</code> 。</p> <h4 id="settimeout"><a href="#settimeout" class="header-anchor">#</a> <code>setTimeout</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/expire" target="_blank" rel="noopener noreferrer">EXPIRE <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。设置数据过期时间。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>time</code> 目标的过期时间，单位 ms</li></ul> <h4 id="deletekey"><a href="#deletekey" class="header-anchor">#</a> <code>deleteKey</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/del" target="_blank" rel="noopener noreferrer">DEL <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。删除数据。</p> <p><strong>参数列表</strong></p> <ul><li><code>...key</code> 待删除的数据的键值，可多个</li></ul> <h4 id="getkeysbyprefix"><a href="#getkeysbyprefix" class="header-anchor">#</a> <code>getKeysByPrefix</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/keys" target="_blank" rel="noopener noreferrer">KEYS <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。根据键值前缀获取数据库中满足条件的键的列表。</p> <p><strong>参数列表</strong></p> <ul><li><code>prefix</code> 在数据库中匹配的键值前缀</li></ul> <h3 id="string"><a href="#string" class="header-anchor">#</a> <code>String</code></h3> <p><a href="https://www.runoob.com/redis/redis-strings.html" target="_blank" rel="noopener noreferrer">字符串 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>相关方法。</p> <h4 id="setstring"><a href="#setstring" class="header-anchor">#</a> <code>setString</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/set" target="_blank" rel="noopener noreferrer">SET <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。设置一个字符串类型的数据。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>value</code> 设置的值，通常可以是 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noopener noreferrer">string <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://developer.mozilla.org/en-US/docs/Glossary/Number" target="_blank" rel="noopener noreferrer">number <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank" rel="noopener noreferrer">boolean <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型</li> <li><code>timeout</code> 可选参数，数据过期时间，单位 ms ，默认不会过期</li></ul> <h4 id="getstring"><a href="#getstring" class="header-anchor">#</a> <code>getString</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/get" target="_blank" rel="noopener noreferrer">GET <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。获取一个字符串类型的数据。当键值不存在时，返回 <code>&quot;&quot;</code> 。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li></ul> <h3 id="hash"><a href="#hash" class="header-anchor">#</a> Hash</h3> <p><a href="https://www.runoob.com/redis/redis-hashes.html" target="_blank" rel="noopener noreferrer">哈希 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>相关方法。</p> <h4 id="sethash"><a href="#sethash" class="header-anchor">#</a> <code>setHash</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/hmset" target="_blank" rel="noopener noreferrer">HMSET <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。设置一个 Hash 类型的数据。</p> <p><strong>参数列表</strong></p> <ul><li><p><code>key</code> 操作目标的键值</p></li> <li><div class="language- extra-class"><pre class="language-text"><code>value
</code></pre></div><p>设置的值，可以为</p> <p>Array</p> <p>和</p> <p>Object</p> <p>两种类型：</p> <ul><li><code>Array</code> 类型时，奇数位的元素为表示字段名的 <code>string</code> 类型的值，偶数位表示前一个元素的字段对应的值，如：<code>[ &quot;k1&quot;, 1, &quot;k2&quot;, &quot;2&quot; ]</code></li> <li><code>Object</code> 类型时，传入一个对象，且它不应该嵌套数组或对象，如：<code>{ k1: 1, k2: &quot;2&quot; }</code></li></ul></li></ul> <h4 id="gethash"><a href="#gethash" class="header-anchor">#</a> <code>getHash</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/hgetall" target="_blank" rel="noopener noreferrer">HGETALL <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。获取一个 Hash 类型数据的所有字段以及值，返回为 <a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#arrays" target="_blank" rel="noopener noreferrer">Object <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型。当键值不存在时，返回 <code>{}</code> 。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li></ul> <h4 id="delhash"><a href="#delhash" class="header-anchor">#</a> <code>delHash</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/hdel" target="_blank" rel="noopener noreferrer">HDEL <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。删除一个 Hash 类型数据的部分字段。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>...fields</code> 待删除的字段名，可多个</li></ul> <h4 id="inchash"><a href="#inchash" class="header-anchor">#</a> <code>incHash</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/hincrby" target="_blank" rel="noopener noreferrer">HINCRBY <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>及 <a href="https://redis.io/commands/hincrbyfloat" target="_blank" rel="noopener noreferrer">HINCRBYFLOAT <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。给一个 Hash 类型数据的某字段加上某值。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>field</code> 待操作的字段名</li> <li><code>increment</code> 添加的值，可为整形或浮点型</li></ul> <h4 id="existhashkey"><a href="#existhashkey" class="header-anchor">#</a> <code>existHashKey</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/hexists" target="_blank" rel="noopener noreferrer">HEXISTS <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。判断一个 Hash 类型数据中是否包含某字段。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>field</code> 带判断的字段名</li></ul> <h3 id="list"><a href="#list" class="header-anchor">#</a> List</h3> <p><a href="https://www.runoob.com/redis/redis-lists.html" target="_blank" rel="noopener noreferrer">列表 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>相关方法。</p> <h4 id="getlist"><a href="#getlist" class="header-anchor">#</a> <code>getList</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/lrange" target="_blank" rel="noopener noreferrer">LRANGE <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。获取一个完整的 List 类型数据。当键值不存在时，返回 <code>[]</code> 。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li></ul> <h4 id="getlistlength"><a href="#getlistlength" class="header-anchor">#</a> <code>getListLength</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/llen" target="_blank" rel="noopener noreferrer">LLEN <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。获取一个 List 类型数据的长度。当键值不存在时，返回 <code>0</code> 。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li></ul> <h4 id="addlistelement"><a href="#addlistelement" class="header-anchor">#</a> <code>addListElement</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/rpush" target="_blank" rel="noopener noreferrer">RPUSH <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。向一个 List 类型数据中添加若干数据。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>...values</code> 待添加的数据，可多个</li></ul> <h4 id="dellistelement"><a href="#dellistelement" class="header-anchor">#</a> delListElement`</h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/lrem" target="_blank" rel="noopener noreferrer">LREM <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。从一个 List 类型数据中删除若干数据。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>...values</code> 待删除的数据，可多个</li></ul> <h4 id="developer-existlistelement-existlistelement"><a href="#developer-existlistelement-existlistelement" class="header-anchor">#</a> /developer/#existlistelement)<code>existListElement</code></h4> <p><strong>作用</strong></p> <p>判断一个 List 类型数据中是否包含某数据。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>value</code> 待判断的数据</li></ul> <h3 id="developer-set-set"><a href="#developer-set-set" class="header-anchor">#</a> /developer/#set)Set</h3> <p><a href="https://www.runoob.com/redis/redis-sets.html" target="_blank" rel="noopener noreferrer">集合 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>相关方法。</p> <h4 id="developer-getset-getset"><a href="#developer-getset-getset" class="header-anchor">#</a> /developer/#getset)<code>getSet</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/smembers" target="_blank" rel="noopener noreferrer">SMEMBERS <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。获取一个 Set 类型数据。当键值不存在时，返回 <code>[]</code> 。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li></ul> <h4 id="developer-getsetmembernum-getsetmembernum"><a href="#developer-getsetmembernum-getsetmembernum" class="header-anchor">#</a> /developer/#getsetmembernum)<code>getSetMemberNum</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/scard" target="_blank" rel="noopener noreferrer">SCARD <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。获取一个 Set 类型数据中含有的成员的数量。当键值不存在时，返回 <code>0</code> 。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li></ul> <h4 id="developer-addsetmember-addsetmember"><a href="#developer-addsetmember-addsetmember" class="header-anchor">#</a> /developer/#addsetmember)<code>addSetMember</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/sadd" target="_blank" rel="noopener noreferrer">SADD <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。向一个 Set 类型数据中添加若干数据。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>...values</code> 待添加的数据，可多个</li></ul> <h4 id="developer-delsetmember-delsetmember"><a href="#developer-delsetmember-delsetmember" class="header-anchor">#</a> /developer/#delsetmember)<code>delSetMember</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/srem" target="_blank" rel="noopener noreferrer">SREN <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。从一个 Set 类型数据中删除若干数据。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>...values</code> 待删除的数据，可多个</li></ul> <h4 id="developer-existsetmember-existsetmember"><a href="#developer-existsetmember-existsetmember" class="header-anchor">#</a> /developer/#existsetmember)<code>existSetMember</code></h4> <p><strong>作用</strong></p> <p>原型 <a href="https://redis.io/commands/sismember" target="_blank" rel="noopener noreferrer">SISMEMBER <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。判断一个 Set 类型数据中是否包含某数据。</p> <p><strong>参数列表</strong></p> <ul><li><code>key</code> 操作目标的键值</li> <li><code>value</code> 待判断的数据</li></ul> <h3 id="client"><a href="#client" class="header-anchor">#</a> client</h3> <p>如果上面的方法不足以实现你的需求，可以使用 <code>client</code> 获取数据库实例对象。</p> <h2 id="botconfig"><a href="#botconfig" class="header-anchor">#</a> BotConfig</h2> <p><code>setting.yml</code> 内的配置数据，详见<a href="https://docs.adachi.top/config/" target="_blank" rel="noopener noreferrer">配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="filemanagement"><a href="#filemanagement" class="header-anchor">#</a> FileManagement</h2> <p>一套简单封装的文件管理方法。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">PresetPlace</span> <span class="token operator">=</span> <span class="token string">&quot;config&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;plugin&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">ManagementMethod</span> <span class="token punctuation">{</span>
	<span class="token comment">// Common</span>
	<span class="token function">isExist</span><span class="token punctuation">(</span> path<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
	<span class="token function">getFilePath</span><span class="token punctuation">(</span> path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> place<span class="token operator">?</span><span class="token operator">:</span> PresetPlace <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	<span class="token comment">// File</span>
	<span class="token function">renameFile</span><span class="token punctuation">(</span> fileName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> newName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> place<span class="token operator">?</span><span class="token operator">:</span> PresetPlace <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
	<span class="token function">readFile</span><span class="token punctuation">(</span> fileName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> place<span class="token operator">:</span> PresetPlace <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	<span class="token comment">// Dir</span>
	<span class="token function">createDir</span><span class="token punctuation">(</span> dirName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> place<span class="token operator">?</span><span class="token operator">:</span> PresetPlace <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
	<span class="token function">getDirFiles</span><span class="token punctuation">(</span> dirName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> place<span class="token operator">?</span><span class="token operator">:</span> PresetPlace <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">// YAML</span>
	<span class="token function">createYAML</span><span class="token punctuation">(</span> ymlName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> place<span class="token operator">?</span><span class="token operator">:</span> PresetPlace <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
	<span class="token function">loadYAML</span><span class="token punctuation">(</span> ymlName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> place<span class="token operator">?</span><span class="token operator">:</span> PresetPlace <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
	<span class="token function">writeYAML</span><span class="token punctuation">(</span> ymlName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> place<span class="token operator">?</span><span class="token operator">:</span> PresetPlace <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
	<span class="token function">updateYAML</span><span class="token punctuation">(</span> ymlName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> place<span class="token operator">?</span><span class="token operator">:</span> PresetPlace<span class="token punctuation">,</span> <span class="token operator">...</span>index<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="presetplace"><a href="#presetplace" class="header-anchor">#</a> PresetPlace</h3> <p>表示用于定位目录的位置</p> <ul><li><code>root</code> 表示 <code>Adachi-BOT</code></li> <li><code>config</code> 表示 <code>Adachi-BOT/config</code> ，所有方法默认情况下都为此值</li> <li><code>plugin</code> 表示 <code>Adachi-BOT/src/plugins</code></li></ul> <h3 id="common-2"><a href="#common-2" class="header-anchor">#</a> Common</h3> <h4 id="isexist"><a href="#isexist" class="header-anchor">#</a> <code>isExist</code></h4> <p>判断某文件/目录是否存在，必须传入完整的路径（绝对路径）。</p> <h4 id="getfilepath"><a href="#getfilepath" class="header-anchor">#</a> <code>getFilePath</code></h4> <p>根据相对路径获取绝对路径。</p> <h3 id="file"><a href="#file" class="header-anchor">#</a> File</h3> <h4 id="renamefile"><a href="#renamefile" class="header-anchor">#</a> <code>renameFile</code></h4> <p>更名文件，<code>fileName</code> 和 <code>newName</code> 均应为相对路径形式。</p> <h4 id="readfile"><a href="#readfile" class="header-anchor">#</a> <code>readFile</code></h4> <p>读取文件内容。</p> <h3 id="directory"><a href="#directory" class="header-anchor">#</a> Directory</h3> <h4 id="createdir"><a href="#createdir" class="header-anchor">#</a> <code>createDir</code></h4> <p>创建目录。</p> <h4 id="getdirfiles"><a href="#getdirfiles" class="header-anchor">#</a> <code>getDirFiles</code></h4> <p>获取一个目录下的所有子级文件名。</p> <h3 id="yaml"><a href="#yaml" class="header-anchor">#</a> YAML</h3> <h4 id="createyaml"><a href="#createyaml" class="header-anchor">#</a> <code>createYAML</code></h4> <p>创建 YAML 文件，并以 <code>data</code> 作为写入数据。</p> <h4 id="loadyaml"><a href="#loadyaml" class="header-anchor">#</a> <code>loadYAML</code></h4> <p>读取 YAML 文件，返回 <a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#arrays" target="_blank" rel="noopener noreferrer">Object <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类型数据。</p> <h4 id="writeyaml"><a href="#writeyaml" class="header-anchor">#</a> <code>writeYAML</code></h4> <p>覆盖写入 YAML 文件。</p> <h4 id="updateyaml"><a href="#updateyaml" class="header-anchor">#</a> <code>updateYAML</code></h4> <p>更新 YAML 文件。<code>index</code> 作为数据索引，将索引到的位置修改为 <code>data</code> 。</p> <h2 id="authorization"><a href="#authorization" class="header-anchor">#</a> Authorization</h2> <p>权限管理方法。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">AuthorizationMethod</span> <span class="token punctuation">{</span>
	<span class="token function">set</span><span class="token punctuation">(</span> userID<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> level<span class="token operator">:</span> AuthLevel <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">get</span><span class="token punctuation">(</span> userID<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>AuthLevel<span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">check</span><span class="token punctuation">(</span> userID<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> limit<span class="token operator">:</span> AuthLevel <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="msgmanagement"><a href="#msgmanagement" class="header-anchor">#</a> MsgManagement</h2> <p>获取发送消息的方法回调</p> <p><code>getPrivateSendFunc</code>：发送主动推送私信的方法（主动发送私聊消息用）</p> <p><code>sendPrivateMessage</code>：发送私聊信息方法（被动回复私聊消息用）</p> <p><code>sendGuildMessage</code>：发送频道信息方法（被动回复频道消息用）</p> <p>如果消息体中不含有<code>msg_id</code>字段则认为是主动推送消息</p> <p>比如<code>sendGuildMessage( &quot;channelID&quot;);</code>则是向子频道推送消息（待测试）</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">MsgManagementMethod</span> <span class="token punctuation">{</span>
	<span class="token function">getPrivateSendFunc</span><span class="token punctuation">(</span> guildId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> userId<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>SendFunc<span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">sendPrivateMessage</span><span class="token punctuation">(</span> guildId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> msg_id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> SendFunc<span class="token punctuation">;</span>
	<span class="token function">sendGuildMessage</span><span class="token punctuation">(</span> channelID<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> msg_id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> SendFunc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="refreshconfig"><a href="#refreshconfig" class="header-anchor">#</a> RefreshConfig</h2> <p>可热更新的配置文件类，用于定义配置文件的热更新方法。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">RefreshCatch</span> <span class="token punctuation">{</span>
	log<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	msg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">RefreshTarget</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span> <span class="token punctuation">[</span> key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span> <span class="token operator">&amp;</span>
	<span class="token punctuation">{</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">RefreshConfigMethod</span> <span class="token punctuation">{</span>
	<span class="token function">registerRefreshableFile</span><span class="token punctuation">(</span> 
		fileName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> target<span class="token operator">:</span> RefreshTarget<span class="token punctuation">,</span> place<span class="token operator">?</span><span class="token operator">:</span> PresetPlace 
	<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
	<span class="token function">registerRefreshableFunc</span><span class="token punctuation">(</span> target<span class="token operator">:</span> RefreshTarget <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="refreshcatch"><a href="#refreshcatch" class="header-anchor">#</a> <code>RefreshCatch</code></h3> <p>刷新时错误返回类型。在出现错误时需 <code>throw</code> 一个该类型的对象。</p> <h3 id="refreshtarget"><a href="#refreshtarget" class="header-anchor">#</a> <code>RefreshTarget</code></h3> <p>配置文件类。我们要求你使用类来定义配置文件，且类中必须包含返回值为 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的公有函数 <code>refresh</code> 。下面以 <code>Cookies</code> 为例，介绍书写的格式：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Cookies</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> cookies<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
	
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>cookies <span class="token operator">=</span> bot<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">loadYAML</span><span class="token punctuation">(</span> <span class="token string">&quot;cookies&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>cookies<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>cookies <span class="token operator">=</span> bot<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">loadYAML</span><span class="token punctuation">(</span> <span class="token string">&quot;cookies&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>cookies<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token string">&quot;cookies 重新加载完毕&quot;</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token operator">&lt;</span>RefreshCatch<span class="token operator">&gt;</span><span class="token punctuation">{</span>
				log<span class="token operator">:</span> <span class="token punctuation">(</span> <span class="token operator">&lt;</span>Error<span class="token operator">&gt;</span>error <span class="token punctuation">)</span><span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
				msg<span class="token operator">:</span> <span class="token string">&quot;cookies 重新加载失败，请前往控制台查看日志&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="registerrefreshablefile"><a href="#registerrefreshablefile" class="header-anchor">#</a> <code>registerRefreshableFile</code></h3> <p><strong>作用</strong></p> <p>注册一个可刷新的配置文件，当 BOT 持有者使用 <code>adachi.refresh</code> 指令时，重新读取所有被注册的文件。</p> <p><strong>参数列表</strong></p> <ul><li><code>fileName</code> 注册的配置文件的文件名</li> <li><code>target</code> 实现 <code>RefreshTarget</code> 接口的类的实例对象，如 <code>new Cookies()</code></li> <li><code>place</code> 可选参数，见 <a href="https://docs.adachi.top/developer/#presetplace" target="_blank" rel="noopener noreferrer">PresetPlace<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="registerrefreshablefunc"><a href="#registerrefreshablefunc" class="header-anchor">#</a> <code>registerRefreshableFunc</code></h3> <p><strong>作用</strong></p> <p>注册一个可刷新的对象，当 BOT 持有者使用 <code>adachi.refresh</code> 指令时，重新加载该对象。</p> <p><strong>参数列表</strong></p> <ul><li><code>target</code> 实现 <code>RefreshTarget</code> 接口的类的实例对象，如 <code>new Cookies()</code></li></ul> <h2 id="path-alias"><a href="#path-alias" class="header-anchor">#</a> Path Alias</h2> <p><code>Adachi-BOT</code> 设有三个路径别名</p> <ul><li><code>@</code> -&gt; <code>./src/</code></li> <li><code>#</code> -&gt; <code>./src/plugins/</code></li> <li><code>ROOT</code> -&gt; <code>app.ts</code></li></ul> <p>导入路径名应尽可能简洁，并尽量避免多层 <code>../</code> 的出现。对于文件 <code>A.ts</code> ：</p> <ul><li>若 <code>B.ts</code> 与 <code>A.ts</code> 处于同级目录或 <code>B.ts</code> 在 <code>A.ts</code> 的同级文件夹的子级目录中，则应该使用 <code>./</code> 来引用</li> <li>若 <code>B.ts</code> 在 <code>A.ts</code> 的祖级目录中，则应该使用 <code>@</code> 或 <code>#</code> 来引用</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c1cc24a2.js" defer></script><script src="/assets/js/2.0695181e.js" defer></script><script src="/assets/js/11.ce63f6ea.js" defer></script>
  </body>
</html>
